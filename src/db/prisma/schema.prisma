generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

generator json {
  provider = "prisma-json-types-generator"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Job {
  id   String @id @default(uuid()) @db.Uuid
  /// [JobData]
  data Json   @default("{}")

  status         JobOperationStatus @default(CREATED)
  /// [PersistenceSnapshot]
  xstate         Json
  percentage     Int             @default(0)
  creationTime   DateTime        @default(now()) @map("creation_time")
  updateTime     DateTime        @updatedAt @map("update_time")
  expirationTime DateTime?       @map("expiration_time")
  type           JobMode         @default(PRE_DEFINED)
  userMetadata   Json            @default("{}")
  priority       Priority        @default(VERY_LOW)
  creator        Creator         @default(UNKNOWN)
  ttl            DateTime?
  notifications  Json            @default("{}")
  name           JobName         @default(DEFAULT)

  @@map("job")
}

enum JobOperationStatus {
  PENDING     @map("Pending")
  IN_PROGRESS @map("In-Progress")
  COMPLETED   @map("Completed")
  FAILED      @map("Failed")
  ABORTED     @map("Aborted")
  WAITING     @map("Waiting")
  CREATED     @map("Created")
  PAUSED      @map("Paused")

  @@map("operation_status_enum")
}

enum Priority {
  VERY_HIGH @map("Very-High")
  HIGH      @map("High")
  MEDIUM    @map("Medium")
  LOW       @map("Low")
  VERY_LOW  @map("Very-Low")

  @@map("priority_enum")
}

enum JobMode {
  PRE_DEFINED @map("Pre-Defined")
  DYNAMIC     @map("Dynamic")

  @@map("job_mode_enum")
}

enum Creator {
  MAP_COLONIES @map("Map-Colonies")
  UNKNOWN      @map("Unknown")

  @@map("creator")
}

enum JobName {
  INGESTION @map("Ingestion")
  EXPORT    @map("Export")
  DEFAULT   @map("Default")

  @@map("job_name_enum")
}
